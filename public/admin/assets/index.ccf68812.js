var h=(m,s,l)=>new Promise((n,i)=>{var u=o=>{try{_(l.next(o))}catch(d){i(d)}},c=o=>{try{_(l.throw(o))}catch(d){i(d)}},_=o=>o.done?n(o.value):Promise.resolve(o.value).then(u,c);_((l=l.apply(m,s)).next())});import{u as q,_ as $}from"./useModal.fbc97b0b.js";import{aY as B,as as L,_ as O,d as I,r as v,bb as V,s as z,v as k,N as g,a4 as P,e as S,f as U,h as t,w as e,i as x,j as p,t as y,g as b,p as j,q as Y,bc as G,l as J,D as K,n as Q}from"./index.e68eab72.js";import"./index.esm.dae7b788.js";function W(){return B.request({url:"/master/ota/check",method:"get"})}function X(){return B.request({url:"/master/ota/update",method:"get"},{isTransformResponse:!1})}function Z(){return B.request({url:"/master/ota/database",method:"get"},{isTransformResponse:!1})}function ee(){return B.request({url:"/master/ota/script",method:"get"},{isTransformResponse:!1})}const te="yyyy-MM-dd HH:mm:ss";function ne(m,s=te){return L(m,s)}const oe=["innerHTML"],ae=["textContent"],ue=I({__name:"index",setup(m){const s=v(),l=V(),n=z({current_version:"",version:"",message:""}),i=v(!1),u=v(!1),c=v(""),[_,{openModal:o,closeModal:d}]=q({title:"\u5728\u7EBF\u66F4\u65B0",closeOnEsc:!1,showIcon:!1});T();function T(){i.value=!0,W().then(a=>{for(const f in a)n[f]=a[f];n.current_version!==n.version&&l.info({title:"\u53D1\u73B0\u65B0\u7248",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",content:()=>k("div",{},["\u5F53\u524D\u7248\u672C: ",k(g,{type:"info"},n.current_version),"\uFF0C\u6700\u65B0\u7248\u672C: ",k(g,{type:"info"},n.version),"\uFF0C\u662F\u5426\u8FDB\u884C\u66F4\u65B0\uFF1F"]),onPositiveClick:()=>{D()}})}).finally(()=>i.value=!1)}function D(){return h(this,null,function*(){o(),u.value=!0;const a=[X,Z,ee];try{for(let f of a){const r=yield f();if(console.log(r),F(r.message),r.status!=="ok"){F("\u7EC8\u6B62\u66F4\u65B0~");break}}F("\u66F4\u65B0\u5B8C\u6BD5~")}finally{u.value=!1}})}function E(){l.info({title:"\u6E29\u99A8\u63D0\u9192",content:"\u60A8\u786E\u5B9A\u66F4\u65B0\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{D()},onNegativeClick:()=>{}})}function M(){return h(this,null,function*(){d(),u.value=!1})}function F(a){a=`
[${ne(new Date,"yyyy-MM-dd HH:mm:ss")}] ${a}`,c.value=(c.value.trim()+a).trim(),P(()=>{s.value.scrollTop=s.value.scrollHeight})}return(a,f)=>{const r=j,w=Y,A=G,C=J,R=K,H=Q,N=$;return S(),U("div",null,[t(H,{bordered:!1,title:"\u5728\u7EBF\u5347\u7EA7",class:"mt-4 proCard",size:"small",segmented:{content:!0}},{default:e(()=>[t(A,{show:i.value},{default:e(()=>[t(w,{bordered:"","label-placement":"left",class:"py-2",column:2},{default:e(()=>[t(r,{label:"\u5F53\u524D\u7248\u672C"},{default:e(()=>[t(x(g),{type:"info"},{default:e(()=>[p(y(n.current_version),1)]),_:1})]),_:1}),t(r,{label:"\u6700\u65B0\u7248\u672C"},{default:e(()=>[t(x(g),{type:"info"},{default:e(()=>[p(y(n.version),1)]),_:1})]),_:1}),t(r,{label:"\u65B0\u7248\u7279\u6027"},{default:e(()=>[b("div",{class:"news",innerHTML:n.message},null,8,oe)]),_:1})]),_:1})]),_:1},8,["show"]),t(R,{size:"large",class:"mt-4"},{default:e(()=>[t(C,{strong:"",type:"primary",onClick:T,loading:i.value},{default:e(()=>[p(" \u68C0\u67E5\u66F4\u65B0 ")]),_:1},8,["loading"]),t(C,{strong:"",type:"primary",onClick:E,loading:u.value},{default:e(()=>[p(" \u7ACB\u5373\u66F4\u65B0 ")]),_:1},8,["loading"])]),_:1})]),_:1}),t(N,{onRegister:x(_),ref:"modalRef",class:"console-modal"},{default:e(()=>[b("div",{ref_key:"consoleEl",ref:s,class:"console",textContent:y(c.value)},null,8,ae)]),action:e(()=>[t(C,{type:"primary",loading:u.value,onClick:M},{default:e(()=>[p(y(u.value?"\u6B63\u5728\u66F4\u65B0":"\u5B8C\u6210\u66F4\u65B0"),1)]),_:1},8,["loading"])]),_:1},8,["onRegister"])])}}});var ce=O(ue,[["__scopeId","data-v-336b5663"]]);export{ce as default};
