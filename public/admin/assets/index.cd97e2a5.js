var ue=Object.defineProperty,te=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var x=(u,l,s)=>l in u?ue(u,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[l]=s,w=(u,l)=>{for(var s in l||(l={}))ae.call(l,s)&&x(u,s,l[s]);if(S)for(var s of S(l))se.call(l,s)&&x(u,s,l[s]);return u},A=(u,l)=>te(u,ne(l));var C=(u,l,s)=>new Promise((v,d)=>{var y=c=>{try{m(s.next(c))}catch(n){d(n)}},B=c=>{try{m(s.throw(c))}catch(n){d(n)}},m=c=>c.done?v(c.value):Promise.resolve(c.value).then(y,B);m((s=s.apply(u,l)).next())});import{D as R,T as oe,B as le}from"./TableAction.ddf2d302.js";import{u as re,B as ie}from"./useForm.a669a7ea.js";import{aY as N,v as _,k as ce,d as de,r as g,u as me,bb as pe,s as D,e as fe,x as _e,w as o,h as a,i as F,j as b,N as he,b6 as ge,y as Fe,z as ve,l as ye,A as Be,C as ke,D as we,E as be,n as Ee}from"./index.e68eab72.js";import"./sortable.esm.bd95be41.js";import"./useDesignSetting.b2231b13.js";import"./index.esm.dae7b788.js";import"./DownOutlined.4f60e279.js";function Ce(u){return N.request({url:"/master/users",method:"get",params:u})}function O(u){return N.request({url:"/master/user",method:"put",params:u})}function T(u){return N.request({url:"/master/user",method:"delete",params:u})}const De=[{type:"selection",key:"selection"},{title:"id",key:"id",width:100,sorter:!0},{title:"\u7528\u6237\u540D",key:"username",width:200,sorter:!0},{title:"avatar",key:"avatar",width:160,render(u){return _(ce,{size:48,src:u.avatar})}},{title:"stars",key:"stars",width:160,render(u){return JSON.stringify(u.stars,null,4)}},{title:"OAuth",key:"oauth",width:160,render(u){return JSON.stringify(u.oauth,null,4)}},{title:"\u521B\u5EFA\u65F6\u95F4",key:"create_time",width:160,sorter:!0},{title:"\u4FEE\u6539\u65F6\u95F4",key:"update_time",width:160,sorter:!0}],Ne={name:"UserList"},qe=de(A(w({},Ne),{setup(u){const l={stars:{required:!0,trigger:["blur","change"],message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684stars"},oauth:{required:!0,trigger:["blur","change"],message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684oauth"}},s=[{field:"username",labelMessage:"\u652F\u6301\u7528\u6237\u540D\u641C\u7D22",component:"NInput",label:"\u7528\u6237\u540D",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",onInput:e=>{p.username=e,console.log(e)}}},{field:"id",label:"id"}],v=g(null),d=me(),y=pe(),B=g(),m=g(!1),c=g(!1),n=D({id:0,username:"",stars:JSON.stringify("[]",null,4),oauth:JSON.stringify("[]",null,4)}),p=D({pageSize:10,username:"",column:"",order:""}),h=g([]),J=D({width:220,title:"\u64CD\u4F5C",key:"action",fixed:"right",render(e){return _(oe,{style:"button",actions:[{label:"\u7F16\u8F91",onClick:K.bind(null,e)},{label:"\u5220\u9664",icon:R,onClick:$.bind(null,e)}]})}}),[q,{}]=re({gridProps:{cols:1},collapsedRows:1,labelWidth:120,schemas:s,showAdvancedButton:!1});function P(){if(h.value.length==0){y.warning({title:"\u8B66\u544A",content:"\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u9879"});return}let e=[];for(const t of h.value)e.push(t.username);y.warning({title:"\u8B66\u544A",content:()=>_("div",["\u60A8\u786E\u5B9A\u8981\u5220\u9664\u4EE5\u4E0B\u5171 ",_(he,{type:"info"},h.value.length)," \u4E2A\u7528\u6237\u5417\uFF1F",_("br"),_(ge,{},e.join("\u3001"))]),negativeText:"\u53D6\u6D88",positiveText:"\u786E\u5B9A",onPositiveClick(){let t=[];for(const r of h.value)t.push(T({id:r.id}).then(()=>{d.success("\u5220\u9664\u6210\u529F")}));Promise.all(t).finally(f)}})}const I=e=>C(this,null,function*(){return yield Ce(w(w({},p),e))});function z({column:e,value:t,record:r}){e.key==="id"&&(r.editValueRefs.name4.value=`${t}`),console.log(e,t,r)}function L({record:e,key:t,value:r}){O({id:e.id,[t]:r}).then(()=>{d.success("\u66F4\u65B0\u6210\u529F"),f()})}function M(e,t){h.value=t.filter(r=>r)}function f(){B.value.reload()}function V(e){e.preventDefault(),c.value=!0,v.value.validate(t=>C(this,null,function*(){try{if(t){d.error("\u8BF7\u586B\u5199\u5B8C\u6574\u4FE1\u606F");return}yield O({id:n.id,username:n.username,stars:JSON.parse(n.stars),oauth:JSON.parse(n.oauth)}),d.success("\u66F4\u65B0\u6210\u529F"),m.value=!1,f()}catch(r){d.error(r.message);return}finally{c.value=!1}}))}function K(e){m.value=!0,[n.id,n.username,n.stars,n.oauth]=[e.id,e.username,JSON.stringify(e.stars,null,4),JSON.stringify(e.oauth,null,4)]}function $(e){T({id:e.id}).then(()=>{d.success("\u5220\u9664\u6210\u529F"),f()})}function W(e){console.log(e),f()}function Y(e){p.username="",console.log(e)}function G(e){console.log(e),e.order?[p.column,p.order]=[e.columnKey,e.order.slice(0,e.order.lastIndexOf("end"))]:[p.column,p.order]=["",""],f()}return(e,t)=>{const r=Fe,H=ve,k=ye,E=Be,Q=ke,X=we,Z=be,j=Ee;return fe(),_e(j,{bordered:!1,class:"proCard"},{default:o(()=>[a(F(ie),{onRegister:F(q),onSubmit:W,onReset:Y},{statusSlot:o(({model:i,field:U})=>[a(r,{value:i[U],"onUpdate:value":ee=>i[U]=ee},null,8,["value","onUpdate:value"])]),_:1},8,["onRegister"]),a(F(le),{columns:F(De),request:I,"row-key":i=>i.id,ref_key:"actionRef",ref:B,actionColumn:J,"onUpdate:checkedRowKeys":M,"scroll-x":1500,onEditEnd:L,onEditChange:z,"onUpdate:sorter":G},{tableTitle:o(()=>[a(k,{type:"primary",onClick:P},{icon:o(()=>[a(H,null,{default:o(()=>[a(F(R))]),_:1})]),default:o(()=>[b(" \u5220\u9664 ")]),_:1})]),toolbar:o(()=>[a(k,{type:"primary",onClick:f},{default:o(()=>[b("\u5237\u65B0\u6570\u636E")]),_:1})]),_:1},8,["columns","row-key","actionColumn"]),a(Z,{show:m.value,"onUpdate:show":t[4]||(t[4]=i=>m.value=i),"show-icon":!1,preset:"dialog",title:"\u7F16\u8F91"},{action:o(()=>[a(X,null,{default:o(()=>[a(k,{onClick:t[3]||(t[3]=()=>m.value=!1)},{default:o(()=>[b("\u53D6\u6D88")]),_:1}),a(k,{type:"info",loading:c.value,onClick:V},{default:o(()=>[b("\u786E\u5B9A")]),_:1},8,["loading"])]),_:1})]),default:o(()=>[a(Q,{model:n,rules:l,ref_key:"formRef",ref:v,"label-placement":"left","label-width":80,class:"py-4"},{default:o(()=>[a(E,{label:"\u7528\u6237\u540D",path:"username"},{default:o(()=>[a(r,{placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",value:n.username,"onUpdate:value":t[0]||(t[0]=i=>n.username=i)},null,8,["value"])]),_:1}),a(E,{label:"stars",path:"stars"},{default:o(()=>[a(r,{placeholder:"\u8BF7\u8F93\u5165stars",value:n.stars,"onUpdate:value":t[1]||(t[1]=i=>n.stars=i),type:"textarea",rows:"10"},null,8,["value"])]),_:1}),a(E,{label:"oauth",path:"oauth"},{default:o(()=>[a(r,{placeholder:"\u8BF7\u8F93\u5165oauth",value:n.oauth,"onUpdate:value":t[2]||(t[2]=i=>n.oauth=i),type:"textarea",rows:"10"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]),_:1})}}}));export{qe as default};
